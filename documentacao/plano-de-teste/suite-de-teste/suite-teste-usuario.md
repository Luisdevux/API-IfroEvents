# Plano de Teste para Model de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite Detalhados                                                                                 |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| Criação válida de usuário            | Deve permitir salvar um usuário com todos os campos obrigatórios            | Criar usuário com dados válidos                           | Usuário salvo (HTTP 201), resposta inclui: <br>```json { "_id":"...", "nome":"...", "email":"...", "criadoEm":"..." } ```<br>Campos `_id` e `criadoEm` gerados automaticamente. |
| Campo email obrigatório e único      | Não permite duplicidade de email                                            | Criar dois usuários com mesmo email                       | HTTP 400 ou 409, body:<br>```json{"message":"E-mail já está em uso."}```                                        |
| Campo senha obrigatório              | Não permite salvar usuário sem senha                                        | Omitir senha                                              | HTTP 400, body:<br>```json{"errors":[{"field":"senha","message":"Senha é obrigatória"}]}```                   |
| Campo nome obrigatório               | Não permite salvar usuário sem nome                                         | Omitir nome                                               | HTTP 400, body:<br>```json{"errors":[{"field":"nome","message":"Nome é obrigatório"}]}```                     |
| Campo status obrigatório             | Aceita apenas valores permitidos para status ('ativo', 'inativo')           | Enviar status inválido                                    | HTTP 400, body:<br>```json{"errors":[{"field":"status","message":"Status inválido"}]}```                      |
| Hash de senha                        | Senha deve ser salva como hash                                              | Criar usuário e verificar hash                            | Campo `senha` não é salvo em texto puro; valor armazenado é hash                                              |
| Isolamento entre testes              | Cada teste deve ser independente                                            | Verificar uso de `deleteMany()` e `jest.clearAllMocks()`  | Execução repetida não interfere, banco em memória limpo                                                        |

# Plano de Teste para Schema Zod - Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite Detalhados                                                             |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------|
| Validação completa (UsuarioSchema)    | Aceita objeto completo com todos os campos válidos                          | Usar `.parse(dadosValidos)`                              | Retorna objeto validado                                                                    |
| Campo email obrigatório e formato     | Deve ser string válida de email                                             | Enviar email inválido                                     | Lança ZodError, mensagem:<br>`"E-mail inválido"`                                           |
| Campo senha obrigatório e string      | Deve ser string não vazia                                                   | Omitir senha ou enviar string vazia                        | Lança ZodError, mensagem:<br>`"Senha é obrigatória"`                                       |
| Campo nome obrigatório e string       | Deve ser string não vazia                                                   | Omitir nome ou enviar string vazia                         | Lança ZodError, mensagem:<br>`"Nome é obrigatório"`                                        |
| Campo status enum                       | Aceita apenas valores permitidos                                            | Enviar status inválido                                      | Lança ZodError, mensagem:<br>`"Status inválido"`                                             |
| Validação negativa: campos ausentes   | Deve rejeitar usuário com campos obrigatórios ausentes                      | Mock com campos ausentes                                  | Validações falham com mensagens personalizadas                                             |

# Plano de Teste para Controller de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite Detalhados                                                                                        |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|
| Cadastro de usuário                  | Permite cadastrar usuário com dados válidos                                 | Enviar `req.body` com dados válidos                       | HTTP 201, body:<br>```json { "message":"Usuário cadastrado com sucesso", "usuario":{...} } ```                       |
| Cadastro - email duplicado           | Não permite cadastrar usuário com email já existente                        | Enviar `req.body` com email já cadastrado                 | HTTP 400 ou 409, body:<br>```json{"message":"E-mail já cadastrado"}```                                                |
| Validação com Zod (body inválido)    | Falha se o corpo da requisição estiver fora do schema                       | Enviar campos inválidos ou faltando                       | HTTP 400, body inclui mensagens do Zod                                                                                |
| Listagem de usuários                 | Retorna todos os usuários cadastrados                                       | Chamar `listar`                                           | HTTP 200, body: array de usuários                                                                                     |
| Listagem por ID                      | Retorna usuário específico pelo ID                                          | Chamar `listarPorId` com ID válido                        | HTTP 200, objeto completo do usuário                                                                                  |
| Erro ao listar usuário inexistente   | Lança erro se o usuário não for encontrado                                  | Enviar ID inexistente                                     | HTTP 404, body:<br>```json { "message":"Usuário não encontrado" } ```                                                 |
| Atualização de usuário               | Atualiza campos permitidos do usuário pelo ID                               | Enviar ID e `req.body` com campos válidos                 | HTTP 200, body: usuário atualizado                                                                                    |
| Inativação/Ativação de usuário       | Altera status do usuário para 'inativo' ou 'ativo' via PATCH                | Enviar ID válido e body { status: 'inativo'/'ativo' }     | HTTP 200, status alterado, body:<br>```json{"message":"Status alterado com sucesso","usuario":{...}}```              |
| Falha ao alterar status sem ID       | Lança erro se o ID estiver ausente ou inválido                              | Chamar PATCH /usuarios/:id/status sem ID ou ID inválido    | HTTP 400, body:<br>```json{"message":"ID ausente ou inválido"}```                                                     |
| Falha ao alterar status com valor inválido | Lança erro se o status enviado for inválido                            | Enviar body { status: 'status_inexistente' }              | HTTP 400, body:<br>```json{"errors":[{"field":"status","message":"Status inválido"}]}```                              |
| Mensagens customizadas                | Mensagens de sucesso e erro devem ser claras e padronizadas                 | Verificar mensagens retornadas                            | Mensagens conforme helpers da aplicação                                                                               |

# Plano de Teste para Service de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite Detalhados                                                                |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| Cadastro de usuário                  | Cria usuário se os dados forem válidos                                      | Chamar `cadastrar(dadosValidados)`                        | Usuário salvo e retornado, objeto conforme modelo                                             |
| Validação de existência por ID       | Antes de alterar/excluir, garante que o usuário exista                      | Chamar `ensureUsuarioExists(id)`                          | Lança erro customizado (404) se não existir, segue normalmente se existir                     |
| Listagem geral                       | Retorna todos os usuários cadastrados                                       | Chamar `listar()`                                         | Array de objetos                                                                              |
| Listagem por ID                      | Retorna usuário específico pelo ID                                          | Chamar `listarPorId(id)`                                  | Objeto completo do usuário, status 200                                                        |
| Atualização completa/parcial         | Permite alterar quaisquer campos válidos                                    | Chamar `alterar(id, campos)`                              | Retorna usuário atualizado, campos alterados conferem com request                             |
| Exclusão de usuário                  | Remove usuário existente após validação                                     | Chamar `deletar(id)`                                      | Usuário removido, busca subsequente retorna erro                                              |
| Tratamento de erros customizados     | Propaga erros customizados para camada superior                             | Simular falhas e capturar erros                           | Mensagem e status conforme erro definido                                                      |
| Validação de ID                      | Todos os métodos lançam erro se o ID for inválido                           | Enviar ID inválido em qualquer método                     | Erro (400), mensagem personalizada                                                            |

# Plano de Teste para Repository de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite Detalhados                                                                |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| Cadastro de usuário                  | Salva usuário completo com base nos dados recebidos                         | Chamar `cadastrar(dadosUsuario)`                          | Usuário salvo corretamente, persistido no banco, campos conferem                              |
| Cadastro - campos obrigatórios       | Lança erro se faltar campo obrigatório                                      | Omitir campo obrigatório e tentar cadastrar                | Erro de validação, mensagem personalizada                                                     |
| Cadastro - email duplicado           | Lança erro se tentar cadastrar email já existente                           | Tentar cadastrar dois usuários com mesmo email             | Erro 400 ou 409, mensagem personalizada                                                       |
| Listagem total                       | Retorna usuários com metadados                               | Chamar `listar()`                                         | Retorna dados de todos os usuários do sistema                  |
| Listagem por ID                      | Busca usuário existente por ID                                              | Chamar `listarPorId(id)`                                  | Objeto correspondente, status 200                                                             |
| Alteração de usuário                 | Altera os dados de um usuário existente                                     | Chamar `alterar(id, parsedData)`                          | Usuário é atualizado, resposta inclui campos alterados                                        |
| Inativação/Ativação de usuário       | Altera status do usuário para 'inativo' ou 'ativo' via PATCH                | Chamar `alterarStatus(id, status)`                        | Campo `status` alterado, resposta inclui status atualizado                                    |
| Erro ao buscar usuário inexistente   | Lança erro customizado se o usuário não for encontrado                      | Simular ID inválido/inexistente                           | Retorna erro customizado (404), mensagem específica                                           |
| Atualização de email                 | Atualiza apenas o campo `email` de um usuário                               | Chamar `alterarEmail(id, email)`                          | Campo `email` atualizado, resposta inclui email novo                                          |

# Plano de Teste para Endpoints de Usuário (Sprint 8)

| Método & Endpoint                        | Cenário / Descrição                                                                 | Verificações / Payloads / Headers                                 | Critérios de Aceite Detalhados                                                                       |
|------------------------------------------|--------------------------------------------------------------------------------------|-------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| POST /usuarios                           | Criação de usuário com dados válidos                                                | Body completo                                                     | HTTP 201, body:<br>```json{"message":"Usuário cadastrado com sucesso","usuario":{...}}```            |
| POST /usuarios                           | Falha com email duplicado                                                           | Body com email já cadastrado                                      | HTTP 400 ou 409, mensagem personalizada                                                              |
| POST /usuarios                           | Falha com dados inválidos                                                           | Body inválido                                                     | HTTP 400, body com mensagens de erro de validação                                                    |
| GET /usuarios                            | Listagem de usuários                                                                | Sem token ou com token                                            | HTTP 200, array de usuários                                                                          |
| GET /usuarios/:id                        | Busca usuário por ID válido                                                         | ID válido                                                         | HTTP 200, objeto do usuário                                                                          |
| GET /usuarios/:id                        | Falha para ID inexistente                                                           | ID inexistente                                                    | HTTP 404, body:<br>```json{"message":"Usuário não encontrado"}```                                    |
| PATCH /usuarios/:id                      | Atualização de usuário com dados válidos                                            | Body com campos válidos                                           | HTTP 200, objeto atualizado                                                                          |
| PATCH /usuarios/:id                      | Falha para ID inexistente                                                           | ID inexistente, body válido                                       | HTTP 404, body:<br>```json{"message":"Usuário não encontrado"}```                                    |
| PATCH /usuarios/:id/status               | Inativação/Ativação de usuário (status para 'inativo' ou 'ativo')                  | Token válido, ID válido, body { status: 'inativo'/'ativo' }       | HTTP 200, body:<br>```json{"message":"Status alterado com sucesso","usuario":{...}}```              |
| PATCH /usuarios/:id/status               | Falha com status inválido                                                           | Token válido, ID válido, body { status: 'status_inexistente' }    | HTTP 400, body:<br>```json{"errors":[{"field":"status","message":"Status inválido"}]}```             |
| PATCH /usuarios/:id/status               | Falha para ID inexistente                                                           | Token válido, ID inexistente, body { status }                     | HTTP 404, body:<br>```json{"message":"Usuário não encontrado"}```                                    |
| PATCH /usuarios/:id/status               | Falha para ID inválido                                                              | Token válido, ID inválido, body { status }                        | HTTP 400, body:<br>```json{"message":"ID ausente ou inválido"}```                                    |
| PATCH /usuarios/:id/status               | Falha sem token de autenticação                                                     | Sem token, ID válido, body { status }                             | HTTP 498, body:<br>```json{"message":"Token de autenticação não fornecido ou inválido"}```           |
| PATCH /usuarios/:id/status               | Falha sem campo status                                                              | Token válido, ID válido, body vazio                               | HTTP 400, body:<br>```json{"errors":[{"field":"status","message":"Campo status é obrigatório"}]}```  |

---