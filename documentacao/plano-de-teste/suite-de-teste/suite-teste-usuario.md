# Plano de Teste para Model de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Criação válida de usuário            | Deve permitir salvar um usuário com todos os campos obrigatórios            | Criar usuário com dados válidos                           | Usuário salvo com sucesso; campos como `_id`, `criadoEm` gerados automaticamente                    |
| Campo email obrigatório e único      | Não permite duplicidade de email                                            | Criar dois usuários com mesmo email                       | Gera erro de unicidade                                                                              |
| Campo senha obrigatório              | Não permite salvar usuário sem senha                                        | Omitir senha                                              | Gera erro de validação                                                                              |
| Campo nome obrigatório               | Não permite salvar usuário sem nome                                         | Omitir nome                                               | Gera erro de validação                                                                              |
| Campo tipo obrigatório               | Aceita apenas valores permitidos para tipo ('comum', 'admin')                | Enviar tipo inválido                                      | Gera erro de status inválido                                                                          |
| Campo status obrigatório             | Aceita apenas valores permitidos para status ('ativo', 'inativo')            | Enviar status inválido                                    | Gera erro de status inválido                                                                             |
| Hash de senha                        | Senha deve ser salva como hash                                              | Criar usuário e verificar hash                            | Senha não é salva em texto puro                                                                      |
| Isolamento entre testes              | Cada teste deve ser independente                                            | Verificar uso de `deleteMany()` e `jest.clearAllMocks()`  | Os testes rodam com banco em memória limpo                                                           |

# Plano de Teste para Schema Zod - Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Validação completa (UsuarioSchema)    | Aceita objeto completo com todos os campos válidos                          | Usar `.parse(dadosValidos)`                              | Retorna objeto validado corretamente                                                                 |
| Campo email obrigatório e formato     | Deve ser string válida de email                                             | Enviar email inválido                                     | Gera erro de validação personalizada                                                                 |
| Campo senha obrigatório e string      | Deve ser string não vazia                                                   | Omitir senha ou enviar string vazia                        | Gera erro de validação personalizada                                                                 |
| Campo nome obrigatório e string       | Deve ser string não vazia                                                   | Omitir nome ou enviar string vazia                         | Gera erro de validação personalizada                                                                 |
| Campo tipo enum                       | Aceita apenas valores permitidos                                            | Enviar tipo inválido                                      | Gera erro de enumeração                                                                              |
| Validação negativa: campos ausentes   | Deve rejeitar usuário com campos obrigatórios ausentes                      | Mock com campos ausentes                                  | Validações falham com mensagens personalizadas                                                       |

# Plano de Teste para Controller de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de usuário                   | Permite cadastrar usuário com dados válidos                                 | Enviar `req.body` com dados válidos                       | Retorna status 201, objeto salvo corretamente, mensagem de sucesso                                   |
| Cadastro - email duplicado            | Não permite cadastrar usuário com email já existente                        | Enviar `req.body` com email já cadastrado                 | Retorna erro de unicidade                                                                            |
| Validação com Zod (body inválido)     | Falha se o corpo da requisição estiver fora do schema                       | Enviar campos inválidos ou faltando                       | Retorna erro estruturado com mensagem do Zod                                                         |
| Listagem de usuários                  | Retorna todos os usuários cadastrados                                       | Chamar `listar`                                           | Retorna status 200, array de usuários                                                                |
| Listagem por ID                       | Retorna usuário específico pelo ID                                          | Chamar `listarPorId` com ID válido                        | Retorna status 200 e objeto completo do usuário                                                      |
| Erro ao listar usuário inexistente    | Lança erro se o usuário não for encontrado                                  | Enviar ID inexistente                                     | Retorna erro com status 404                                                                          |
| Atualização de usuário                | Atualiza campos permitidos do usuário pelo ID                               | Enviar ID e `req.body` com campos válidos                 | Retorna status 200 e dados atualizados                                                               |
| Inativação/Ativação de usuário        | Altera status do usuário para 'inativo' ou 'ativo' via PATCH                | Enviar ID válido e body { status: 'inativo'/'ativo' }     | Retorna status 200, status alterado, mensagem de sucesso                                             |
| Falha ao alterar status sem ID        | Lança erro se o ID estiver ausente ou inválido                              | Chamar PATCH /usuarios/:id/status sem ID ou ID inválido    | Lança erro com status 400                                                                            |
| Falha ao alterar status com valor inválido | Lança erro se o status enviado for inválido                            | Enviar body { status: 'status_inexistente' }              | Lança erro com status 400                                                                            |
| Mensagens customizadas                | Mensagens de sucesso e erro devem ser claras e padronizadas                 | Verificar mensagens retornadas                            | Mensagens conforme helpers                                                                           |

# Plano de Teste para Service de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de usuário                   | Cria usuário se os dados forem válidos                                      | Chamar `cadastrar(dadosValidados)`                        | Usuário salvo e retornado com sucesso                                                                |
| Validação de existência por ID        | Antes de alterar/excluir, garante que o usuário exista                      | Chamar `ensureUsuarioExists(id)`                          | Lança erro se não existir, continua se encontrar                                                     |
| Listagem geral                        | Retorna todos os usuários cadastrados                                       | Chamar `listar()`                                          | Retorna array com dados dos usuários                                                                 |
| Listagem por ID                       | Retorna usuário específico pelo ID                                          | Chamar `listarPorId(id)`                                   | Retorna objeto completo do usuário                                                                   |
| Atualização completa/parcial          | Permite alterar quaisquer campos válidos                                    | Chamar `alterar(id, campos)`                               | Retorna usuário atualizado com sucesso                                                               |
| Exclusão de usuário                   | Remove usuário existente após validação                                     | Chamar `deletar(id)`                                       | Usuário é removido                                                                                   |
| Tratamento de erros customizados      | Propaga erros customizados para camada superior                             | Simular falhas e capturar erros                            | Erros lançados corretamente, mensagens padronizadas                                                  |
| Validação de ID                       | Todos os métodos lançam erro se o ID for inválido                           | Enviar ID inválido em qualquer método                      | Lança erro de validação                                                                              |

# Plano de Teste para Repository de Usuário (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                      | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|----------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de usuário                   | Salva usuário completo com base nos dados recebidos                         | Chamar `cadastrar(dadosUsuario)`                           | Usuário salvo corretamente no banco                                                                  |
| Cadastro - campos obrigatórios        | Lança erro se faltar campo obrigatório                                      | Omitir campo obrigatório e tentar cadastrar                | Lança erro de validação                                                                              |
| Cadastro - email duplicado            | Lança erro se tentar cadastrar email já existente                           | Tentar cadastrar dois usuários com mesmo email             | Lança erro de unicidade                                                                              |
| Listagem total                        | Retorna usuários com metadados e paginação                                 | Chamar `listar()`                                          | Retorna array de usuários, totalDocs, page, limit                                                    |
| Listagem por ID                       | Busca usuário existente por ID                                              | Chamar `listarPorId(id)`                                   | Retorna objeto correspondente ao usuário                                                             |
| Alteração de usuário                  | Altera os dados de um usuário existente                                     | Chamar `alterar(id, parsedData)`                           | Usuário é atualizado e salvo com sucesso                                                             |
| Inativação/Ativação de usuário        | Altera status do usuário para 'inativo' ou 'ativo' via PATCH                | Chamar `alterarStatus(id, status)`                         | Usuário tem status alterado corretamente                                                             |
| Erro ao buscar usuário inexistente    | Lança erro customizado se o usuário não for encontrado                      | Simular ID inválido/inexistente                            | Retorna erro customizado com status 404                                                              |
| Atualização de email                  | Atualiza apenas o campo `email` de um usuário                               | Chamar `alterarEmail(id, email)`                           | Campo `email` atualizado corretamente                                                                |

# Plano de Teste para Endpoints de Usuário (Sprint 8)

| Método & Endpoint                        | Cenário / Descrição                                                                 | Verificações / Payloads / Headers                                 | Critérios de Aceite                                                                                  |
|------------------------------------------|--------------------------------------------------------------------------------------|-------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| POST /usuarios                           | Criação de usuário com dados válidos                                                | Body completo                                                     | 201, objeto salvo corretamente, campos conferem                                                       |
| POST /usuarios                           | Falha com email duplicado                                                           | Body com email já cadastrado                                      | 400, mensagem de erro de unicidade                                                                    |
| POST /usuarios                           | Falha com dados inválidos                                                           | Body inválido                                                     | 400, mensagens de erro de validação                                                                   |
| GET /usuarios                            | Listagem de usuários                                                                | Sem token ou com token                                            | 200, array de usuários                                                                                |
| GET /usuarios/:id                        | Busca usuário por ID válido                                                         | ID válido                                                         | 200, objeto do usuário                                                                                |
| GET /usuarios/:id                        | Falha para ID inexistente                                                           | ID inexistente                                                    | 404                                                                                                   |
| PATCH /usuarios/:id                      | Atualização de usuário com dados válidos                                            | Body com campos válidos                                           | 200, campos atualizados                                                                               |
| PATCH /usuarios/:id                      | Falha para ID inexistente                                                           | ID inexistente, body válido                                       | 404                                                                                                   |
| PATCH /usuarios/:id/status                | Inativação/Ativação de usuário (status para 'inativo' ou 'ativo')                  | Token válido, ID válido, body { status: 'inativo'/'ativo' }       | 200, status alterado, mensagem de sucesso                                                             |
| PATCH /usuarios/:id/status                | Falha com status inválido                                                           | Token válido, ID válido, body { status: 'status_inexistente' }    | 400                                                                                                   |
| PATCH /usuarios/:id/status                | Falha para ID inexistente                                                           | Token válido, ID inexistente, body { status }                     | 404                                                                                                   |
| PATCH /usuarios/:id/status                | Falha para ID inválido                                                              | Token válido, ID inválido, body { status }                        | 400                                                                                                   |
| PATCH /usuarios/:id/status                | Falha sem token de autenticação                                                     | Sem token, ID válido, body { status }                             | 498                                                                                                   |
| PATCH /usuarios/:id/status                | Falha sem campo status                                                              | Token válido, ID válido, body vazio                               | 400                                                                                                   |
