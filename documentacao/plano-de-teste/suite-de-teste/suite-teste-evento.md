# Plano de Teste para Model de Evento (Sprint 8)

| Funcionalidade                          | Comportamento Esperado                                                                  | Verificações                                                        | Critérios de Aceite                                                                                  |
|----------------------------------------|------------------------------------------------------------------------------------------|----------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| Criação válida de evento               | Deve permitir salvar um evento completo com todos os campos obrigatórios                | Criar um evento com dados válidos (título, descrição, data, etc.)   | Evento é salvo com sucesso; campos como `_id`, `eventoCriadoEm` são gerados automaticamente          |
| Campo status (enum)                    | Aceita apenas "ativo" ou "inativo" como status                                          | Criar eventos com status: ativo e inativo                           | Ambos os valores são salvos com sucesso                                                               |
| Status inválido                        | Deve falhar se for passado um valor fora do enum                                        | Criar evento com status: "teste"                                    | Gera erro de validação de enumeração                                                                  |
| Campo obrigatório titulo               | Campo obrigatório                                                                       | Omitir `titulo` ao criar evento                                     | Gera erro de validação                                                                                 |
| Campo obrigatório descricao            | Campo obrigatório                                                                       | Omitir `descricao`                                                  | Gera erro de validação                                                                                 |
| Campo obrigatório local                | Campo obrigatório                                                                       | Omitir `local`                                                      | Gera erro de validação                                                                                 |
| Campo obrigatório dataEvento           | Campo obrigatório e deve ser tipo Date                                                  | Enviar string ou omitir campo                                       | Gera erro de tipo ou de ausência                                                                       |
| Subdocumento organizador              | Deve conter um `_id` válido e um nome                                                   | Testar com `_id` inválido ou ausente                                | Gera erro de referência inválida ou ausência                                                           |
| Campo linkInscricao                   | Deve ser uma URL válida                                                                 | Enviar URL inválida                                                 | Gera erro de validação                                                                                 |
| Campo tags                             | Deve ser array de strings (mínimo 1 item)                                               | Enviar array vazio ou não array                                     | Gera erro de validação                                                                                 |
| Campo categoria                        | Obrigatório, tipo string                                                                | Omitir campo ou enviar string vazia                                 | Gera erro de validação                                                                                 |
| Campos de mídia (capa, carrossel, vídeo) | Devem conter ao menos um objeto com altura, largura, url, tamanhoMb                    | Enviar array vazio ou objetos incompletos                           | Gera erro de validação                                                                                 |
| Autopreenchimento eventoCriadoEm      | Deve ser preenchido automaticamente ao salvar                                           | Criar evento sem o campo e verificar após o save                    | Campo preenchido automaticamente como instância de `Date`                                             |
| Relacionamento com usuários           | O campo `organizador._id` deve referenciar um usuário existente                         | Criar evento com referência inexistente ou inválida                 | Erro ou falha de integridade                                                                           |
| Isolamento entre testes               | Cada teste deve ser independente dos demais                                             | Verificar uso de `deleteMany()` e `jest.clearAllMocks()`            | Os testes rodam com banco em memória limpo                                                             |

# Plano de Teste para Schema Zod - Evento (Sprint 8)

| Funcionalidade                      | Comportamento Esperado                                                                     | Verificações                                              | Critérios de Aceite                                                                                  |
|------------------------------------|----------------------------------------------------------------------------------------------|------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| Validação completa (EventoSchema)  | Deve aceitar objeto completo com todos os campos válidos                                    | Usar `.parse(dadosValidos)`                               | Retorna objeto validado corretamente                                                                  |
| Campo titulo obrigatório e string  | Deve falhar se ausente ou não for string                                                    | Enviar `titulo: ""` ou não enviar                         | Gera erro com mensagem personalizada                                                                  |
| Campo descricao obrigatório        | Deve ser string não vazia                                                                   | Enviar `descricao: ""` ou omitir                          | Gera erro de validação                                                                                 |
| Campo local obrigatório            | Deve ser string não vazia                                                                   | Enviar `local: ""` ou omitir                              | Gera erro                                                                                              |
| Campo dataEvento como Date         | Deve converter string ISO para `Date` válida                                                | Usar `.coerce.date()` com string                          | Campo é aceito e convertido corretamente                                                               |
| Campo organizador como objeto      | Deve conter `_id` (ObjectId) e `nome` como string                                           | Omitir `_id`, ou `nome`, ou ambos                         | Erro de validação detalhada                                                                           |
| Campo linkInscricao                | Deve ser uma URL válida                                                                     | Enviar string inválida como `"not_a_url"`                | Gera erro com mensagem de URL inválida                                                                |
| Campo tags                         | Deve conter pelo menos uma string válida                                                    | Enviar `[]` ou `[123]`                                    | Gera erro de array vazio ou tipo inválido                                                             |
| Campo categoria obrigatório        | Deve ser string                                                                              | Omitir ou enviar `""`                                     | Gera erro                                                                                              |
| Campo status enum                  | Aceita apenas "ativo" ou "inativo"                                                           | Enviar valor fora do enum                                 | Gera erro de enum inválido                                                                            |
| Campos de mídia (capa, vídeo, carrossel) | Cada item deve conter `url`, `tamanhoMb`, `altura`, `largura` com tipos corretos   | Enviar objeto incompleto ou tipos errados                | Gera erros específicos por campo                                                                      |
| Validação negativa: campos ausentes | Deve rejeitar evento com campos obrigatórios ausentes                                       | Mock com campos como `descricao`, `local`, etc. ausentes | Validações falham com mensagens personalizadas                                                        |

# Plano de Teste para Controller de Evento (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                                                 | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de evento                   | Deve permitir o cadastro completo de evento, processando arquivos se enviados                | Enviar `req.body` e `req.files` (opcional)                | Retorna status 201, objeto salvo corretamente, mensagem de sucesso                                   |
| Validação com Zod (body inválido)    | Deve falhar se o corpo da requisição estiver fora do schema                                 | Enviar campos inválidos ou faltando                       | Retorna erro estruturado com mensagem do Zod                                                          |
| Processamento de arquivos/mídias     | Deve processar arquivos enviados e limpar arquivos em caso de erro                           | Enviar arquivos inválidos                                 | Arquivos processados ou limpos corretamente                                                          |
| Listagem geral de eventos            | Retorna todos os eventos cadastrados                                                        | Chamar `listar` sem `req.params.id`                       | Retorna status 200, array de eventos                                                                  |
| Listagem por ID                      | Retorna evento específico pelo ID                                                           | Chamar `listar` com `req.params.id`                       | Retorna status 200 e objeto completo do evento                                                       |
| Erro ao listar evento inexistente    | Deve lançar erro se o evento não for encontrado                                             | Enviar ID inexistente                                     | Retorna erro com status 404                                                                          |
| Validação de ID inválido             | Todos os métodos devem lançar erro se o ID for inválido                                     | Enviar ID inválido em qualquer método                      | Retorna erro de validação                                                                            |
| Atualização de evento                | Atualiza campos permitidos do evento pelo ID                                                | Enviar ID e `req.body` com campos válidos                 | Retorna status 200 e dados atualizados                                                               |
| Exclusão de evento                   | Remove evento existente com sucesso                                                         | Enviar ID válido                                          | Retorna status 200 com mensagem de confirmação                                                       |
| Falha ao deletar sem ID              | Deve lançar erro se o ID estiver ausente ou inválido                                        | Chamar `deletar` sem `req.params.id`                      | Lança `CustomError` com status 400                                                                   |
| Alteração de status                  | Permite mudar entre `ativo` e `inativo`, validando mídias obrigatórias se necessário         | Enviar PATCH com novo status e validarMidias               | Evento atualizado com sucesso, status alterado, mídias validadas se necessário                       |
| Geração de QR Code                   | Deve gerar QR Code para o link de inscrição do evento                                       | Chamar `gerarQRCode` com ID válido                         | Retorna status 200, objeto com QR Code                                                               |
| Geração de QR Code - erros           | Deve lançar erro se ID não for fornecido ou evento não encontrado                           | Chamar `gerarQRCode` sem ID ou com ID inexistente           | Retorna erro apropriado                                                                              |
| Compartilhamento de permissão        | Deve compartilhar permissão com sucesso                                                     | Enviar email, permissão, expiraEm                          | Retorna status 200, mensagem de sucesso                                                              |
| Compartilhamento - email inválido    | Deve lançar erro se email for inválido                                                      | Enviar email inválido                                      | Retorna erro de validação                                                                            |
| Compartilhamento - data expirada     | Deve lançar erro se data de expiração for passada                                           | Enviar expiraEm no passado                                  | Retorna erro de validação                                                                            |
| Compartilhamento - permissão padrão  | Deve usar permissão padrão se não fornecida                                                 | Omitir campo permissao                                     | Permissão padrão utilizada                                                                           |
| Mensagens customizadas               | Mensagens de sucesso e erro devem ser claras e padronizadas                                 | Verificar mensagens retornadas                              | Mensagens conforme helpers                                                                           |

# Plano de Teste para Service de Evento (Sprint 8)

| Funcionalidade                        | Comportamento Esperado                                                                                 | Verificações                                              | Critérios de Aceite                                                                                  |
|--------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de evento                   | Cria evento se os dados forem válidos                                                      | Chamar `cadastrar(dadosValidados)`                        | Evento salvo e retornado com sucesso                                                                 |
| Validação de existência por ID       | Antes de alterar/excluir, garante que o evento exista                                      | Chamar `ensureEventoExists(id)`                           | Lança `CustomError` se não existir, continua se encontrar                                            |
| Listagem geral                       | Retorna todos os eventos cadastrados                                                       | Chamar `listar(req)`                                      | Retorna array com dados dos eventos                                                                  |
| Listagem por ID                      | Retorna evento específico pelo ID                                                          | Chamar `listarPorId(id)`                                   | Retorna objeto completo do evento                                                                   |
| Atualização completa/parcial         | Permite alterar quaisquer campos válidos                                                   | Chamar `alterar(id, campos)`                               | Retorna evento atualizado com sucesso                                                               |
| Exclusão de evento                   | Remove evento existente após validação                                                     | Chamar `deletar(id)`                                       | Evento é removido                                                                                   |
| Alteração de status                  | Altera somente o campo de status (ativo/inativo), validando mídias obrigatórias se preciso  | Chamar `alterarStatus(id, status)`                        | Status atualizado com sucesso, mídias validadas se necessário                                       |
| Compartilhamento de permissão        | Compartilha permissão de acesso a evento com usuário por email                             | Chamar `compartilharPermissao(id, email, permissao, expiraEm)` | Permissão compartilhada, registro criado, email enviado                                             |
| Compartilhamento - email inválido    | Deve lançar erro se email for inválido                                                     | Enviar email inválido                                     | Lança erro de validação                                                                             |
| Compartilhamento - data expirada     | Deve lançar erro se data de expiração for passada                                          | Enviar expiraEm no passado                                | Lança erro de validação                                                                             |
| Compartilhamento - permissão padrão  | Usa permissão padrão se não fornecida                                                      | Omitir campo permissao                                    | Permissão padrão utilizada                                                                          |
| Verificação de permissão             | Garante que usuário tem permissão para ação                                                | Chamar métodos que exigem permissão                       | Lança erro se não autorizado                                                                        |
| Validação de mídias                  | Valida presença e formato de mídias obrigatórias                                           | Chamar métodos com mídias ausentes ou inválidas            | Lança erro de validação                                                                             |
| Tratamento de erros customizados     | Propaga erros customizados para camada superior                                            | Simular falhas e capturar erros                           | Erros lançados corretamente, mensagens padronizadas                                                 |
| Validação de ID                      | Todos os métodos lançam erro se o ID for inválido                                          | Enviar ID inválido em qualquer método                     | Lança erro de validação                                                                             |

# Plano de Teste para Repository de Evento (Sprint 8)              

| Funcionalidade                          | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                  |
|----------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| Cadastro de evento                     | Salva evento completo com base nos dados recebidos                                  | Chamar `cadastrar(dadosEvento)`                                     | Evento salvo corretamente no banco                                                                    |
| Cadastro - campos obrigatórios         | Deve lançar erro se faltar campo obrigatório                                         | Omitir campo obrigatório e tentar cadastrar                         | Lança erro de validação                                                                               |
| Cadastro - tipos inválidos             | Deve lançar erro se algum campo tiver tipo inválido                                  | Enviar campo com tipo errado (ex: data como string)                 | Lança erro de cast ou validação                                                                       |
| Cadastro - arrays obrigatórios         | Deve lançar erro se arrays obrigatórios estiverem vazios                             | Enviar arrays vazios (ex: tags, mídias)                             | Lança erro de validação                                                                               |
| Cadastro - campos de mídia inválidos   | Deve lançar erro se campos de mídia estiverem incompletos                            | Omitir altura/largura/tamanhoMb/url em mídias                       | Lança erro de validação                                                                               |
| Listagem total                        | Retorna eventos com metadados e paginação                                            | Chamar `listar(req)`                                                | Retorna array de eventos, totalDocs, page, limit                                                      |
| Listagem - erro de banco               | Deve lançar erro se houver falha ao listar                                           | Simular erro no método paginate                                     | Lança erro de banco                                                                                    |
| Listagem por ID                        | Busca evento existente por ID                                                        | Chamar `listarPorId(id)`                                            | Retorna objeto correspondente ao evento                                                               |
| Listagem por ID - não encontrado       | Deve lançar erro se evento não for encontrado                                        | Buscar por ID inexistente                                           | Lança erro customizado                                                                                 |
| Listagem por ID - erro de banco        | Deve lançar erro se houver falha ao buscar por ID                                    | Simular erro no método findById                                     | Lança erro de banco                                                                                    |
| Alteração de evento                    | Altera os dados de um evento existente                                               | Chamar `alterar(id, parsedData)`                                    | Evento é atualizado e salvo com sucesso                                                                |
| Alteração - evento inexistente         | Deve lançar erro se tentar alterar evento inexistente                                | Alterar com ID inexistente                                          | Lança erro customizado                                                                                 |
| Alteração - erro de banco              | Deve lançar erro se houver falha ao alterar                                          | Simular erro no método findByIdAndUpdate                            | Lança erro de banco                                                                                    |
| Atualização de status                  | Atualiza apenas o campo `status` de um evento                                        | Chamar `alterarStatus(id, status)`                                  | Campo `status` atualizado corretamente                                                                 |
| Atualização de status - inexistente    | Deve lançar erro se tentar alterar status de evento inexistente                      | Alterar status com ID inexistente                                   | Lança erro customizado                                                                                 |
| Atualização de status - erro de banco  | Deve lançar erro se houver falha ao alterar status                                   | Simular erro no método findByIdAndUpdate                            | Lança erro de banco                                                                                    |
| Exclusão de evento                     | Remove evento com base no ID                                                         | Chamar `deletar(id)`                                                | Evento é removido com sucesso                                                                          |
| Exclusão - evento inexistente          | Deve lançar erro se tentar deletar evento inexistente                                | Deletar com ID inexistente                                          | Lança erro customizado                                                                                 |
| Exclusão - erro de banco               | Deve lançar erro se houver falha ao deletar                                          | Simular erro no método findByIdAndDelete                            | Lança erro de banco                                                                                    |
| Listagem com filtros avançados         | Aplica filtros de título, descrição, local, categoria, status, tags, tipo, datas      | Chamar `listar(req)` com diferentes queries                         | Retorna eventos filtrados corretamente                                                                 |
| Listagem - filtro usuário autenticado  | Aplica filtros específicos para usuário autenticado                                   | Chamar `listar(req)` com user autenticado                           | Retorna eventos conforme usuário                                                                       |
| Listagem - filtro status padrão        | Aplica filtro status ativo para não autenticado                                       | Chamar `listar(req)` sem user                                      | Retorna apenas eventos ativos                                                                          |
| Listagem - ignorar filtro status       | Ignora filtro status padrão se solicitado                                             | Chamar `listar(req)` com ignorarFiltroStatusPadrao                  | Retorna todos os eventos                                                                               |
| Listagem - status como array           | Aceita múltiplos status para filtro                                                   | Chamar `listar(req)` com status array                              | Retorna eventos com status correspondentes                                                             |
| Listagem - filtro tipo                 | Aplica filtro de tipo (futuro, passado, etc)                                          | Chamar `listar(req)` com tipo                                      | Retorna eventos filtrados por tipo                                                                     |
| Listagem - filtro intervalo de data    | Aplica filtro de data se tipo não fornecido                                           | Chamar `listar(req)` com dataInicio/dataFim                        | Retorna eventos no intervalo                                                                           |
| Listagem - filtro organizadorId        | Usa organizadorId se fornecido                                                        | Chamar `listar(req)` com organizadorId                             | Retorna eventos do organizador                                                                         |
| Listagem - limite máximo de página     | Limita número de itens por página a 100                                               | Chamar `listar(req)` com limite alto                               | Retorna no máximo 100 itens                                                                            |
| aplicarFiltroStatusAtivo               | Método auxiliar para decidir se aplica filtro status ativo                             | Chamar `aplicarFiltroStatusAtivo` com diferentes cenários           | Retorna true/false conforme regras                                                                     |

# Plano de Teste para Endpoints de Evento (Sprint 8)

| Método & Endpoint                        | Cenário / Descrição                                                                 | Verificações / Payloads / Headers                                 | Critérios de Aceite                                                                                  |
|------------------------------------------|--------------------------------------------------------------------------------------|-------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| POST /eventos                           | Criação de evento com dados válidos                                                 | Token válido, body completo                                       | 201, objeto salvo corretamente, campos conferem                                                       |
| POST /eventos                           | Falha sem token de autenticação                                                     | Sem token                                                         | 498 (não autorizado)                                                                                  |
| POST /eventos                           | Falha com dados inválidos                                                           | Token válido, body inválido                                       | 400, mensagens de erro de validação                                                                   |
| GET /eventos                            | Listagem pública de eventos                                                         | Sem token                                                         | 200, array de eventos                                                                                 |
| GET /eventos                            | Listagem autenticada de eventos                                                     | Token válido                                                      | 200, array de eventos                                                                                 |
| GET /eventos/:id                        | Busca evento por ID válido (público)                                                | Sem token, ID válido                                              | 200, objeto do evento                                                                                 |
| GET /eventos/:id                        | Busca evento por ID válido (autenticado)                                            | Token válido, ID válido                                           | 200, objeto do evento                                                                                 |
| GET /eventos/:id                        | Falha para ID inexistente                                                           | Token válido, ID inexistente                                      | 404                                                                                                   |
| PATCH /eventos/:id                      | Atualização de evento com dados válidos                                             | Token válido, body com campos válidos                             | 200, campos atualizados                                                                               |
| PATCH /eventos/:id                      | Falha para ID inexistente                                                           | Token válido, ID inexistente, body válido                         | 404                                                                                                   |
| PATCH /eventos/:id                      | Falha sem token de autenticação                                                     | Sem token, body válido                                            | 498                                                                                                   |
| PATCH /eventos/:id/status               | Alteração de status do evento                                                       | Token válido, body { status }                                     | 200, status alterado                                                                                  |
| PATCH /eventos/:id/status               | Falha sem token de autenticação                                                     | Sem token, body { status }                                        | 498                                                                                                   |
| DELETE /eventos/:id                     | Deleção de evento existente                                                         | Token válido, ID válido                                           | 200, evento removido, GET retorna 404                                                                 |
| DELETE /eventos/:id                     | Falha para ID inexistente                                                           | Token válido, ID inexistente                                      | 404                                                                                                   |
| DELETE /eventos/:id                     | Falha sem token de autenticação                                                     | Sem token, ID válido                                              | 498                                                                                                   |
| GET /eventos/:id/qrcode                 | Geração de QR Code para evento válido (público)                                     | Sem token, ID válido                                              | 200 ou 404 (dependendo do evento)                                                                     |
| GET /eventos/:id/qrcode                 | Geração de QR Code para evento válido (autenticado)                                 | Token válido, ID válido                                           | 200, objeto com QR Code                                                                               |
| GET /eventos/:id/qrcode                 | Falha para ID inexistente                                                           | Token válido, ID inexistente                                      | 404                                                                                                   |
| PATCH /eventos/:id/compartilhar         | Compartilhamento de permissão com dados válidos                                     | Token válido, body com email, permissao, expiraEm                 | 200 ou 404 (dependendo do endpoint)                                                                   |
| PATCH /eventos/:id/compartilhar         | Falha com email inválido                                                            | Token válido, email inválido                                      | 400                                                                                                   |
| PATCH /eventos/:id/compartilhar         | Falha com data de expiração no passado                                              | Token válido, expiraEm passada                                    | 400                                                                                                   |
| PATCH /eventos/:id/compartilhar         | Falha sem token de autenticação                                                     | Sem token, body válido                                            | 498                                                                                                   |
| POST /eventos/:id/midia/:tipo           | Upload de capa, vídeo ou carrossel com sucesso                                      | Token válido, arquivo válido                                      | 200, mídia salva                                                                                      |
| POST /eventos/:id/midia/:tipo           | Falha sem arquivo para capa                                                         | Token válido, sem arquivo                                         | 400                                                                                                   |
| POST /eventos/:id/midia/:tipo           | Falha com tipo de mídia inválido                                                    | Token válido, tipo inválido                                       | 400                                                                                                   |
| GET /eventos/:id/midias                 | Listagem de todas as mídias do evento                                               | Token válido ou sem token                                         | 200, array de mídias                                                                                  |
| GET /eventos/:id/midia/capa             | Listagem de capas                                                                   | Token válido ou sem token                                         | 200, array de capas                                                                                   |
| GET /eventos/:id/midia/video            | Listagem de vídeos                                                                  | Token válido ou sem token                                         | 200, array de vídeos                                                                                  |
| GET /eventos/:id/midia/carrossel        | Listagem de carrossel                                                               | Token válido ou sem token                                         | 200, array de carrossel                                                                               |
| DELETE /eventos/:eventoId/midia/:tipo/:midiaId | Remoção de mídia específica                                                   | Token válido, tipo e midiaId válidos                              | 200, mídia removida                                                                                   |